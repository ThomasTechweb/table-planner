<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Wedding Planner</title>
    <link rel="stylesheet" href="http://code.jquery.com/ui/1.11.4/themes/smoothness/jquery-ui.css">
    <!-- Latest compiled and minified CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/css/bootstrap.min.css">
    <script src="http://code.jquery.com/jquery-1.10.2.js"></script>
    <script src="http://code.jquery.com/ui/1.11.4/jquery-ui.js"></script>
    <!-- Latest compiled and minified JavaScript -->
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/js/bootstrap.min.js"></script>
    <style>
      #wp-tables, .row { margin-top: 20px; }
      .wp-table ul { min-height: 20px; }
      .btn-remove { position: absolute; right: 20px; top: 8px; }
    </style>
    <script>
    $(function() {
      $(".draggable").draggable({ scroll: true,  scrollSpeed: 100, scrollSensitivity: 100 });
    });
    $(function() {
      $(".sortable").sortable({ connectWith: ['.connectedSortable'] });
    });

    function add_person(name, $list) {
      console.log('add person', name);
      return $("<li class='list-group-item'>"+name+"</li>").appendTo($list);
    }

    function add_table(name, canvas) {
      console.log('add table', name);
      return $("<div class='wp-table draggable col-xs-3'> \
          <div class='panel panel-default'> \
            <div class='panel-heading'> \
              <h3 class='panel-title'>"+name+"</h3> \
              <button type='button' class='btn btn-xs btn-default btn-remove'> \
                <span class='glyphicon glyphicon-remove' aria-hidden='true'></span> \
              </button> \
            </div> \
            <div class='panel-body'> \
              <ul class='sortable connectedSortable list-group'> \
              </ul> \
              <div class='form-group has-feedback'> \
                <input type='text' class='form-control add-person' placeholder='Add person' /> \
                <i class='glyphicon glyphicon-user form-control-feedback'></i> \
              </div> \
            </div> \
          </div> \
        </div>").appendTo(canvas);
    }

    $(document).ready(function() {
      // add a table
      $("#btn-add-table").keypress(function(e){
        $el = $(e.target);
        if (e.which == 13) {
          $table = add_table($el.val(), "#wp-tables .draggable-tables")
          // TODO
          $(".draggable").draggable({ scroll: true,  scrollSpeed: 100, scrollSensitivity: 100 });
          $(".sortable").sortable({ connectWith: ['.connectedSortable'] });
          // BAD
          $table.find(".btn-remove").click(function(e){
            $(e.target).parents(".wp-table").remove();
          });
          $table.find(".add-person").keypress(function(e){
            if (e.which == 13) {
              add_person($(e.target).val(), $(e.target).parent().siblings('.sortable'))
            }
          });
        }
      });

      // remove a table
      $("#draggable2 .btn-remove").click(function(e){
        $(e.target).parents(".wp-table").remove();
      });

      // add a person
      $("#draggable2 .add-person").keypress(function(e){
        if (e.which == 13) {
          add_person($(e.target).val(), $(e.target).parent().siblings('.sortable'))
        }
      });


    });
    </script>
  </head>
  <body>
    <div class="container">
      <div class="row">
        <div class="col-xs-12">
          <h1>Tatiana and Daniel's Wedding Day</h1>

          <!--
          <ul class="nav nav-tabs">
            <li role="presentation" class="active"><a href="#">People</a></li>
            <li role="presentation"><a href="#">Tables</a></li>
            <li role="presentation"><a href="#">View</a></li>
          </ul>
        -->

          <div id="wp-tables" class="row col-xs-12">
            
            <div class='form-group has-feedback'>
              <input type='text' id='btn-add-table' class='form-control' placeholder='Add table...' />
              <i class='glyphicon glyphicon-plus form-control-feedback'></i>
            </div>

            <div class='row draggable-tables'>
              <!-- Add Tables here -->
              <div id="draggable2" class='draggable wp-table col-xs-3' >
                <div class="panel panel-default">
                  <div class="panel-heading">
                    <h3 class="panel-title">Table 2</h3>
                    <button type="button" class='btn btn-xs btn-default btn-remove'>
                      <span class="glyphicon glyphicon-remove" aria-hidden="true"></span>
                    </button>
                  </div>
                  <div class="panel-body">
                    <ul id='sortable2' class="sortable connectedSortable list-group">
                      <li class="list-group-item">Daniel</li>
                      <li class="list-group-item">Tatiana</li>
                    </ul>
                    <div class='form-group has-feedback'>
                      <input type='text' class='add-person form-control' placeholder='Add person' />
                      <i class='glyphicon glyphicon-user form-control-feedback'></i>
                    </div>
                  </div>
                </div>
              </div>
             
            <!-- End tables -->
            </div>

            
          </div>

        </div>
      </div>
    </div>
  </body>
</html>